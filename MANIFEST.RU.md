# üìú –ú–∞–Ω–∏—Ñ–µ—Å—Ç FAA

> ¬´–ö–æ—Ä–æ—Ç–∫–æ¬ª –æ —Ç–æ–º, "–∑–∞—á–µ–º" –∏ "–∫–∞–∫" —É—Å—Ç—Ä–æ–µ–Ω–∞ Feature-Action Architecture.

[![üá¨üáß Read in English](https://img.shields.io/badge/%F0%9F%87%AC%F0%9F%87%A7-Read%20in%20English-blue)](./MANIFEST.md)

---

## üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ó–∞—á–µ–º FAA](#-–∑–∞—á–µ–º-faa)
- [5 –ü—Ä–∞–≤–∏–ª](#-5-–ø—Ä–∞–≤–∏–ª)
- [–ê–Ω–∞—Ç–æ–º–∏—è Feature](#-–∞–Ω–∞—Ç–æ–º–∏—è-feature)
- [–ê–Ω–∞—Ç–æ–º–∏—è Entity](#-–∞–Ω–∞—Ç–æ–º–∏—è-entity)
- [–ö—É–¥–∞ –ö–ª–∞—Å—Ç—å –ö–æ–¥](#Ô∏è-–∫—É–¥–∞-–∫–ª–∞—Å—Ç—å-–∫–æ–¥)
- [–ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã](#-–∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã)
- [–ö–æ–≥–¥–∞ –ù–∞—Ä—É—à–∞—Ç—å –ü—Ä–∞–≤–∏–ª–∞](#-–∫–æ–≥–¥–∞-–Ω–∞—Ä—É—à–∞—Ç—å-–ø—Ä–∞–≤–∏–ª–∞)

---

## üí° –ó–∞—á–µ–º FAA

–ú—ã –≤—Å–µ —á–µ—Ä–µ–∑ —ç—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏. –û—Ç–∫—Ä—ã–≤–∞–µ—à—å –ø—Ä–æ–µ–∫—Ç –∏ –≤–∏–¥–∏—à—å:

```
services/UserService.ts      ‚Äî 400 —Å—Ç—Ä–æ–∫, —Ç—É—Ç –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –∏ –ø—Ä–æ—Ñ–∏–ª–∏, –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
services/OrderService.ts     ‚Äî 600 —Å—Ç—Ä–æ–∫, –∫–æ—Ä–∑–∏–Ω–∞, –æ–ø–ª–∞—Ç–∞, –¥–æ—Å—Ç–∞–≤–∫–∞
repositories/UserRepository   ‚Äî –ø–æ–ª–æ–≤–∏–Ω–∞ –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–æ—Å—Ç–æ –∑–æ–≤—ë—Ç .findOne()
```

–ì—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É "—Å–µ—Ä–≤–∏—Å–æ–º" –∏ "—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º" —Ä–∞–∑–º—ã—Ç–∞. –û–¥–∏–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø–∏—à–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å–µ—Ä–≤–∏—Å–µ, –¥—Ä—É–≥–æ–π ‚Äî –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –¢—Ä–µ—Ç–∏–π —Å–æ–∑–¥–∞—ë—Ç "—Ö–µ–ª–ø–µ—Ä", –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç, –∫—É–¥–∞ –ø–æ–ª–æ–∂–∏—Ç—å. –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ª–∞–±–∏—Ä–∏–Ω—Ç.

**FAA –¥–∞—ë—Ç —á—ë—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞.** –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ‚Äî –ø—Ä–∞–≤–∏–ª–∞. –ß—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (–∏ –∫–∞–∂–¥—ã–π AI-–∞–≥–µ–Ω—Ç) –∑–Ω–∞–ª, –∫—É–¥–∞ –∏–º–µ–Ω–Ω–æ –∫–ª–∞—Å—Ç—å –∫–æ–¥.

---

## ‚ö° 5 –ü—Ä–∞–≤–∏–ª

### –ü—Ä–∞–≤–∏–ª–æ 1: üçï –†–µ–∂—å, –∞ –Ω–µ —Å–ª–æ–∏

**–ù–µ** –æ—Ä–≥–∞–Ω–∏–∑—É–π –∫–æ–¥ –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Ä–æ–ª–∏. **–û—Ä–≥–∞–Ω–∏–∑—É–π** –ø–æ –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω—É.

```
‚ùå –ü–ª–æ—Ö–æ                         ‚úÖ –•–æ—Ä–æ—à–æ
controllers/                     features/
  authController.ts                auth/
  userController.ts                  api/handler.ts
services/                            login.action.ts
  authService.ts                   user-profile/
  userService.ts                     api/handler.ts
repositories/                        get-profile.action.ts
  authRepo.ts
  userRepo.ts
```

> –•–æ—á–µ—à—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –ª–æ–≥–∏–Ω–µ? –í FAA –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å `features/auth/` ‚Äî –≤—Å—ë –Ω–∞ –º–µ—Å—Ç–µ)

### –ü—Ä–∞–≤–∏–ª–æ 2: ‚ö° Actions, –∞ –Ω–µ Services

Service ‚Äî —ç—Ç–æ –º–µ—à–æ–∫ —Å–ª–∞–±–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤. Action ‚Äî —ç—Ç–æ **–æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è**, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç **–æ–¥–Ω—É –≤–µ—â—å**.

```
‚ùå UserService.register()       ‚úÖ features/auth/register.action.ts
‚ùå UserService.getProfile()     ‚úÖ features/user-profile/get-profile.action.ts
‚ùå UserService.updateSettings() ‚úÖ features/settings/update.action.ts
```

Actions —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **—Ñ–∞–±—Ä–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∫ –ø—Ä–∏–º–µ—Ä—É —á–µ—Ä–µ–∑ `typed-inject`):

```typescript
export const createRegisterAction = (deps: { userDal, mailer }) =>
  async (data: RegisterInput) => {
    const user = await deps.userDal.create(data);
    await deps.mailer.sendWelcome(user.email);
    return user;
  };
```

<details>
<summary>üîå <b>–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ typed-inject (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ)</b></summary>

```typescript
import { createInjector } from "typed-inject";

const container = createInjector()
  .provideFactory("userDal", createUserDal)
  .provideFactory("mailer", createMailer)
  .provideFactory("registerAction", createRegisterAction);

const register = container.resolve("registerAction");
```

</details>

> [!TIP]
> Action ‚Äî —ç—Ç–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä. –û–Ω –∑–æ–≤—ë—Ç Entity DAL, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –í—Å—ë.

### –ü—Ä–∞–≤–∏–ª–æ 3: ‚¨áÔ∏è –°—Ç—Ä–æ–≥–æ –í–Ω–∏–∑

```
App ‚Üí Features ‚Üí Entities ‚Üí Shared
```

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–µ–ª–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç **–≤–Ω–∏–∑**. –ë–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π[^1].

- Feature **–º–æ–∂–µ—Ç** –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Entity –∏ Shared
- Entity **–º–æ–∂–µ—Ç** –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Shared
- Feature **–Ω–µ –º–æ–∂–µ—Ç** –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é Feature
- Entity **–Ω–µ –º–æ–∂–µ—Ç** –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é Entity
- –ò–∑ App –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –Ω–∏–∫—Ç–æ (–∫—Ä–æ–º–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞)

[^1]: –ù—É, –µ—Å—Ç—å –ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –°–º–æ—Ç—Ä–∏ [–ö–æ–≥–¥–∞ –ù–∞—Ä—É—à–∞—Ç—å –ü—Ä–∞–≤–∏–ª–∞](#-–∫–æ–≥–¥–∞-–Ω–∞—Ä—É—à–∞—Ç—å-–ø—Ä–∞–≤–∏–ª–∞).

### –ü—Ä–∞–≤–∏–ª–æ 4: üìç –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö

–ù–µ —Å–≤–∞–ª–∏–≤–∞–π –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É `repositories/`. –ö–ª–∞–¥–∏ –∏—Ö **—Ç—É–¥–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è**.

| –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ | –ì–¥–µ –∂–∏–≤—ë—Ç | –ü—Ä–∏–º–µ—Ä |
|---|---|---|
| –ë–∞–∑–æ–≤—ã–π CRUD | `entities/{name}/dal.ts` | `findById`, `create`, `update` |
| –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ | `entities/{name}/lib/` | `getOrCreate`, `updatePrivacy` |
| –§–∏—á–∞-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | `features/{name}/db/` | –°–ª–æ–∂–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, –¥–∂–æ–π–Ω—ã, –æ—Ç—á—ë—Ç—ã |

> [!NOTE]
> –í–æ—Ç –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Å–∞–π—Ç: aggregation pipeline –¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ `UserEntity`. –û–Ω –∂–∏–≤—ë—Ç –≤ `features/leaderboard/db/pipelines.ts`.

### –ü—Ä–∞–≤–∏–ª–æ 5: üîå –Ø–≤–Ω—ã–µ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ù–∏–∫–∞–∫–∏—Ö —Å–∫—Ä—ã—Ç—ã—Ö –≥–ª–æ–±–∞–ª–æ–≤. –ù–∏–∫–∞–∫–∏—Ö `import db from '../../../shared/db'` –≥–ª—É–±–æ–∫–æ –≤ —Å–µ—Ä–≤–∏—Å–µ. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ **—Ñ–∞–±—Ä–∏—á–Ω—É—é –∏–Ω—ä–µ–∫—Ü–∏—é** (–∫ –ø—Ä–∏–º–µ—Ä—É —á–µ—Ä–µ–∑ `typed-inject`):

```typescript
// ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —è–≤–Ω—ã–µ –∏ –≤–∏–¥–∏–º—ã–µ
export const createLoginAction = (deps: { userDal, config }) =>
  async (data) => { /* ... */ };

// ‚ùå –°–∫—Ä—ã—Ç–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞
import { db } from "../../../shared/db";
export const login = async (data) => {
  const user = await db.users.findOne(/*...*/);
};
```

> [!TIP]
> –Ø–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ = –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–π –º–æ–∫–∏), –ª–µ–≥–∫–æ –ø–æ–Ω–∏–º–∞—Ç—å (—á–∏—Ç–∞–π —Ç–∞–π–ø-—Å–∏–≥–Ω–∞—Ç—É—Ä—É), –ª–µ–≥–∫–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å (–Ω–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è).

---

## üî¨ –ê–Ω–∞—Ç–æ–º–∏—è Feature

–ö–∞–∂–¥–∞—è —Ñ–∏—á–∞ —Å–ª–µ–¥—É–µ—Ç –æ–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

```
features/{feature-name}/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ handler.ts         # HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ pipelines.ts       # –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î (–∞–≥—Ä–µ–≥–∞—Ü–∏–∏, –¥–∂–æ–π–Ω—ã)
‚îÇ   ‚îî‚îÄ‚îÄ cache.ts           # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ helpers.ts         # –õ–æ–∫–∞–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã —Ñ–∏—á–∏
‚îú‚îÄ‚îÄ {name}.action.ts       # üåü –û–°–ù–û–í–ù–ê–Ø –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ types.ts               # –¢–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îî‚îÄ‚îÄ index.ts               # –ü—É–±–ª–∏—á–Ω–æ–µ API (—Ç–æ–ª—å–∫–æ —ç—Ç–æ –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å!)
```

> [!IMPORTANT]
> `index.ts` ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞**. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî internal. –í–Ω–µ—à–Ω–∏–π –∫–æ–¥ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏–∑ `features/auth/index.ts`, –Ω–∏–∫–æ–≥–¥–∞ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `features/auth/lib/helpers.ts`.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª

| –§–∞–π–ª | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å | –¢–æ–ª—â–∏–Ω–∞ |
|---|---|---|
| `api/handler.ts` | –ü–∞—Ä—Å–∏—Ç –∑–∞–ø—Ä–æ—Å ‚Üí –∑–æ–≤—ë—Ç action ‚Üí —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç | –¢–æ–Ω–∫–∏–π |
| `*.action.ts` | –û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã entity, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ | **–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞** |
| `db/pipelines.ts` | –§–∏—á–∞-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–∞–≥—Ä–µ–≥–∞—Ü–∏–∏, —Å–ª–æ–∂–Ω—ã–µ –¥–∂–æ–π–Ω—ã) | –î–∞–Ω–Ω—ã–µ |
| `lib/` | –í—ã—á–∏—Å–ª–µ–Ω–∏—è, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è | –•–µ–ª–ø–µ—Ä—ã |
| `types.ts` | –¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã | –¢–∏–ø—ã |
| `index.ts` | –†–µ—ç–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ API | –ë–∞—Ä—Ä–µ–ª—å |

---

## üì¶ –ê–Ω–∞—Ç–æ–º–∏—è Entity

Entities –≤–ª–∞–¥–µ—é—Ç –¥–æ–º–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç **–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ** –æ–ø–µ—Ä–∞—Ü–∏–∏:

```
entities/{entity-name}/
‚îú‚îÄ‚îÄ model.ts              # –°—Ö–µ–º–∞ –ë–î
‚îú‚îÄ‚îÄ dal.ts                # Data Access Layer (CRUD)
‚îú‚îÄ‚îÄ cache.ts              # –û–ø–µ—Ä–∞—Ü–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ queries.ts        # –°–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ commands.ts       # –°–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏
‚îÇ   ‚îî‚îÄ‚îÄ helpers.ts        # –ß–∏—Å—Ç—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ types.ts              # TypeScript —Ç–∏–ø—ã, –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö —ç—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–∞–∫ –∂–µ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤
```

### DAL vs Lib

| `dal.ts` | `lib/` |
|---|---|
| –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π CRUD | –ë–æ–≥–∞—Ç–∞—è –¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ |
| `findById`, `create`, `update`, `delete` | `getOrCreate`, `findWithRelations` |
| –ù–æ–ª—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ | –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ |
| –ï—Å—Ç—å —É –∫–∞–∂–¥–æ–π entity | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ |

> [!TIP]
> –ï—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—à—å—Å—è "—ç—Ç–æ CRUD –∏–ª–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞?" ‚Äî –µ—Å–ª–∏ —ç—Ç–æ –±–æ–ª—å—à–µ —á–µ–º `Model.findOne()`, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –º–µ—Å—Ç–æ –≤ `lib/`.

---

## üó∫Ô∏è –ö—É–¥–∞ –ö–ª–∞—Å—Ç—å –ö–æ–¥

–ö–æ–≥–¥–∞ –Ω–µ —É–≤–µ—Ä–µ–Ω, —Å–ª–µ–¥—É–π —ç—Ç–æ–º—É:

```mermaid
graph TD
    START["–£ –º–µ–Ω—è –Ω–æ–≤—ã–π –∫–æ–¥"] --> Q1{"–ß–∏—Å—Ç–∞—è —É—Ç–∏–ª–∏—Ç–∞?\n(datetime, encoding, math)"}
    Q1 -->|–î–∞| SHARED["üìÅ shared/lib/"]
    Q1 -->|–ù–µ—Ç| Q2{"–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞?\n(–¥—Ä–∞–π–≤–µ—Ä –ë–î, –ª–æ–≥–≥–µ—Ä, –∫–æ–Ω—Ñ–∏–≥)"}
    Q2 -->|–î–∞| INFRA["üìÅ shared/infra/"]
    Q2 -->|–ù–µ—Ç| Q3{"–ë–∞–∑–æ–≤—ã–π CRUD\n–¥–ª—è –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏?"}
    Q3 -->|–î–∞| DAL["üìÅ entities/{name}/dal.ts"]
    Q3 -->|–ù–µ—Ç| Q4{"–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –¥–æ–º–µ–Ω–Ω–∞—è\n–ª–æ–≥–∏–∫–∞ –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏?"}
    Q4 -->|–î–∞| LIB["üìÅ entities/{name}/lib/"]
    Q4 -->|–ù–µ—Ç| Q5{"–°–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å\n–Ω—É–∂–Ω—ã–π –æ–¥–Ω–æ–π —Ñ–∏—á–µ?"}
    Q5 -->|–î–∞| FDB["üìÅ features/{name}/db/"]
    Q5 -->|–ù–µ—Ç| ACTION["üìÅ features/{name}/*.action.ts"]

    style SHARED fill:#fff3e0,stroke:#f57c00
    style INFRA fill:#fff3e0,stroke:#f57c00
    style DAL fill:#e8f5e9,stroke:#388e3c
    style LIB fill:#e8f5e9,stroke:#388e3c
    style FDB fill:#f3e5f5,stroke:#7b1fa2
    style ACTION fill:#f3e5f5,stroke:#7b1fa2
```

–ë—ã—Å—Ç—Ä–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞:

| –ú–Ω–µ –Ω—É–∂–Ω–æ... | –ö–ª–∞–¥—É –≤... |
|---|---|
| –ù–∞–π—Ç–∏ —é–∑–µ—Ä–∞ –ø–æ ID | `entities/user/dal.ts` |
| –ù–∞–π—Ç–∏-–∏–ª–∏-—Å–æ–∑–¥–∞—Ç—å —é–∑–µ—Ä–∞ | `entities/user/lib/queries.ts` |
| –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å username | `entities/user/lib/helpers.ts` |
| –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø-10 –¥–ª—è –≥–æ–Ω–∫–∏ | `features/leaderboard/race/db/pipelines.ts` |
| –°–≥–µ–Ω–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä, –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—á–∏–≤–∫–∏ | `features/cock-size/generate.action.ts` |
| –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—É –ø–æ –ú–æ—Å–∫–≤–µ | `shared/lib/datetime/` |
| –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MongoDB | `shared/infra/persistence/` |
| –û–±—Ä–∞–±–æ—Ç–∞—Ç—å `POST /api/auth/login` | `features/auth/api/handler.ts` |

---

## üö´ –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã

### ‚ùå God Action

```typescript
// –ü–õ–û–•–û: –æ–¥–∏–Ω action –¥–µ–ª–∞–µ—Ç –≤—Å—ë
export const createEverythingAction = (deps) =>
  async (userId) => {
    // 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    // 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
    // 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  };
```

**–§–∏–∫—Å:** —Ä–∞–∑–±–µ–π –Ω–∞ `loginAction`, `getProfileAction`, `notifyAction`.

### ‚ùå Feature –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç Feature

```typescript
// –ü–õ–û–•–û: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
import { getProfile } from "../user-profile";

export const createDashboardAction = () =>
  async () => {
    const profile = await getProfile(); // ‚ùå
  };
```

**–§–∏–∫—Å:** –≤—ã–Ω–µ—Å–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ Entity, –ø—É—Å—Ç—å –æ–±–µ —Ñ–∏—á–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –æ—Ç—Ç—É–¥–∞.

### ‚ùå –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ DAL

```typescript
// –ü–õ–û–•–û: dal.ts –Ω–µ –¥–æ–ª–∂–µ–Ω —Å—á–∏—Ç–∞—Ç—å —É—Ä–æ–≤–Ω–∏
export const createUserDal = () => ({
  levelUp: async (userId: string) => {
    const user = await UserModel.findById(userId);
    const newLevel = Math.floor(user.exp / 100); // ‚ùå –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    return UserModel.updateOne({ _id: userId }, { level: newLevel });
  },
});
```

**–§–∏–∫—Å:** —Ä–∞—Å—á—ë—Ç —É—Ä–æ–≤–Ω—è ‚Äî –≤ `entities/user/lib/` –∏–ª–∏ –≤ action —Ñ–∏—á–∏.

### ‚ùå –ó–∞–ø—Ä–æ—Å—ã –Ω–µ –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ

```typescript
// –ü–õ–û–•–û: –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä–±–æ—Ä–¥—É
// shared/queries/top-players-pipeline.ts  ‚Üê ‚ùå
```

**–§–∏–∫—Å:** `features/leaderboard/db/pipelines.ts` ‚Äî –¥–µ—Ä–∂–∏ —Ç–∞–º, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

---

## ü§ù –ö–æ–≥–¥–∞ –ù–∞—Ä—É—à–∞—Ç—å –ü—Ä–∞–≤–∏–ª–∞

FAA ‚Äî –ø—Ä–∞–∫—Ç–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∞ –Ω–µ –¥–æ–≥–º–∞. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:

| –°–∏—Ç—É–∞—Ü–∏—è | –ö–æ–º–ø—Ä–æ–º–∏—Å—Å | –£—Å–ª–æ–≤–∏–µ |
|---|---|---|
| –î–≤—É–º —Ñ–∏—á–∞–º –Ω—É–∂–µ–Ω –æ–¥–∏–Ω —Ö–µ–ª–ø–µ—Ä | –û—Å—Ç–∞–≤—å –≤ –æ–¥–Ω–æ–π —Ñ–∏—á–µ, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π –∏–∑ –¥—Ä—É–≥–æ–π | **–í—Ä–µ–º–µ–Ω–Ω–æ.** –ó–∞–ø–ª–∞–Ω–∏—Ä—É–π –≤—ã–Ω–æ—Å –≤ Entity/Shared. |
| –§–æ—Ä–º—É–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 3+ —Ñ–∏—á–∞—Ö | –ü–æ–ª–æ–∂–∏ –≤ `shared/lib/` | –î–∞–∂–µ –µ—Å–ª–∏ –≤—ã–≥–ª—è–¥–∏—Ç "–±–∏–∑–Ω–µ—Å–æ–≤–æ" |
| –ú–∞–ª–µ–Ω—å–∫–∞—è —Ñ–∏—á–∞ –±–µ–∑ `db/` | –ü—Ä–æ–ø—É—Å—Ç–∏ –ø–∞–ø–∫—É | –ù–µ –∫–∞–∂–¥–æ–π —Ñ–∏—á–µ –Ω—É–∂–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î |
| Entity –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–π entity | –°–¥–µ–ª–∞–π –¥–∂–æ–∏–Ω –≤ Action —Ñ–∏—á–∏ | Entity –æ—Å—Ç–∞—ë—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π, Feature –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç |

> [!CAUTION]
> –ù–∞—Ä—É—à–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ ‚Äî –æ–∫, **–µ—Å–ª–∏ —Ç—ã —ç—Ç–æ –ø—Ä–∏–∑–Ω–∞—ë—à—å** –∏ –µ—Å—Ç—å –ø–ª–∞–Ω –ø–æ–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ç–æ–º. –¢–∏—Ö–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∫–æ–ø—è—Ç—Å—è –≤ —Å–ø–∞–≥–µ—Ç—Ç–∏)
